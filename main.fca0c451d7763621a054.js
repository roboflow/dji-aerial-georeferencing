(self.webpackChunkdji_aerial_georeferencing=self.webpackChunkdji_aerial_georeferencing||[]).push([[179],{29:(e,t,n)=>{var o=n(202);e.exports=(o.default||o).template({1:function(e,t,n,o,r){return'                <div class="bg-green-700 rounded-md shadow-lg text-center p-4 flex-1">\n                    <h3>Video Added</h3>\n                    <i class="fa-regular fa-square-check text-4xl mt-4 mb-2"></i>\n                </div>\n'},3:function(e,t,n,o,r){return'                <div id="videoButton" class="bg-purple-700 rounded-md shadow-lg text-center p-4 flex-1 hover:bg-purple-600 cursor-pointer">\n                    <h3>Add Drone Video</h3>\n                    <i class="fa-regular fa-video text-4xl mt-4 mb-2"></i>\n                </div>\n'},5:function(e,t,n,o,r){return'                <div class="bg-green-700 rounded-md shadow-lg text-center p-4 flex-1">\n                    <h3>Flight Log Added</h3>\n                    <i class="fa-regular fa-square-check text-4xl mt-4 mb-2"></i>\n                </div>\n'},7:function(e,t,n,o,r){return'                <div id="flightLogButton" class="bg-purple-700 rounded-md shadow-lg text-center p-4 flex-1 hover:bg-purple-600 cursor-pointer">\n                    <h3>Add Flight Log</h3>\n                    <i class="fa-regular fa-file-csv text-4xl mt-4 mb-2"></i>\n                </div>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,n,o,r){var a,i=null!=t?t:e.nullContext||{},l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div id="dropContainer" class="w-full h-full bg-gray-900 text-purple-100 flex items-center justify-center">\n    <div class="py-4 px-8 bg-purple-900 rounded-md shadow-xl outline outline-1 outline-purple-400 outline-offset-4">\n        <h2 class="text-sm font-bold uppercase">Roboflow / DJI</h2>\n        <h1 class="text-2xl font-light">Drone Video Georeferencing Demo</h1>\n        <div class="flex space-x-4 mt-5 text-white">\n'+(null!=(a=l(n,"if").call(i,null!=t?l(t,"videoFile"):t,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.program(3,r,0),data:r,loc:{start:{line:6,column:12},end:{line:16,column:19}}}))?a:"")+(null!=(a=l(n,"if").call(i,null!=t?l(t,"flightLogFile"):t,{name:"if",hash:{},fn:e.program(5,r,0),inverse:e.program(7,r,0),data:r,loc:{start:{line:17,column:12},end:{line:27,column:19}}}))?a:"")+'        </div>\n        <p class="text-purple-400 text-center mt-5 text-sm">Need Your Flight Log? <a class="hover:underline hover:text-white text-purple-200" href="https://blog.roboflow.com/georeferencing-drone-videos/" target="_blank">Read the Blog Post</a></p>\n        <p class="text-purple-400 text-center text-sm">Just testing? <a class="hover:underline hover:text-white text-purple-200" href="https://drive.google.com/drive/folders/1m0lmYyLEQJiaykf821rYtyRvlO5Q_SAf" target="_blank">Download Sample Files</a></p>\n    </div>\n</div>\n\n<div class="hidden">\n    <input id="videoInput" type="file" accept="video/*">\n    <input id="flightLogInput" type="file" accept="text/csv, application/csv">\n</div>'},useData:!0})},261:(e,t,n)=>{var o=n(202);e.exports=(o.default||o).template({compiler:[8,">= 4.3.0"],main:function(e,t,n,o,r){return'<div id="map"></div>'},useData:!0})},227:()=>{},225:(e,t,n)=>{const o="rf_5w20VzQObTXjJhTjq6kad9ubrm33",r="aerial-solar-panels",a=5,i=.6,l=.5,d=n(755);window.$=d;const s=n(486);window._=s,d((function(){n(622)(),window.model=null,s.defer((function(){try{roboflow.auth({publishable_key:o}).load({model:r,version:a}).then((function(e){e.configure({threshold:i,overlap:l}),window.model=e}))}catch(e){console.error("error loading model",e&&e.error)}}))}))},567:(e,t,n)=>{const o="pk.eyJ1IjoieWVsZGFyYnkiLCJhIjoiY2w3czRlcG5qMGxvbDNxbnVoOTUzeW9nNCJ9.RKnzgCuuLaaFzcFsuZWdFQ",r=20,a=3,i=n(158);window.mapboxgl=i,n(652),i.accessToken=o;const l=n(460),d={point:n(102).point,rhumbDestination:n(54).Z,distance:n(13).Z};window.turf=d;const s=function(e){return new Promise((function(t){var n=new FileReader;n.onload=function(e){var n=e.target.result,o=l.parse(n,{header:!0,transformHeader:function(e){return e.trim()}});t(o.data)},n.readAsText(e)}))};e.exports=async function(e,t){var o=n(261);$("body").html(o());const l=await s(t);var u=[],c=-1/0,p=1/0,g=1/0,f=-1/0;_.find(l,(function(e){if("0"==e.isVideo)return u.length;e.latitude=parseFloat(e.latitude),e.longitude=parseFloat(e.longitude),u.push(e),e.longitude>c&&(c=e.longitude),e.longitude<p&&(p=e.longitude),e.latitude<g&&(g=e.latitude),e.latitude>f&&(f=e.latitude)}));const h=new i.Map({container:"map",zoom:1,style:"mapbox://styles/mapbox/streets-v11"});window.map=h,h.on("load",(function(){var t={type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[_.map(u,(function(e){return[e.longitude,e.latitude]}))]}}};h.addSource("dronePath",t),h.addLayer({id:"droneOutline",type:"line",source:"dronePath",layout:{},paint:{"line-color":"#6706CE","line-width":3}}),h.addSource("video",{type:"video",urls:[URL.createObjectURL(e)],coordinates:[[(c+p)/2+7e-4,(g+f)/2-7e-4],[(c+p)/2+7e-4,(g+f)/2+7e-4],[(c+p)/2-7e-4,(g+f)/2+7e-4],[(c+p)/2-7e-4,(g+f)/2-7e-4]]}),h.addLayer({id:"video",type:"raster",source:"video"}),h.fitBounds([[c,g],[p,f]],{padding:50});var n=h.getSource("video"),o=59*Math.PI/180,l=Math.tan(o),s=!1,m=0,v=[],b=function(){requestAnimationFrame(b);var e=n.video;if(e&&e.videoWidth){e.playbackRate=4;var{videoWidth:t,videoHeight:o,currentTime:c}=e,p=Math.floor(10*c),g=u[p%u.length],f=d.point([g.longitude,g.latitude]),x=.3048*parseFloat(g["ascent(feet)"])*l,y=x/2,w=(parseFloat(g["compass_heading(degrees)"])-90)%360,k=180*Math.atan(o/t)/Math.PI,L={units:"meters"},C=d.rhumbDestination(f,y,(w-k+180)%360-180,L).geometry.coordinates,D=d.rhumbDestination(f,y,(w+k+180)%360-180,L).geometry.coordinates,F=d.rhumbDestination(f,y,(w-k)%360-180,L).geometry.coordinates,P=d.rhumbDestination(f,y,(w+k)%360-180,L).geometry.coordinates;n.setCoordinates([D,F,P,C]),window.model&&!s&&Date.now()-m>=200&&(s=!0,e.pause(),window.model.detect(e).then((function(e){_.each(e,(function(e){var n=[e.bbox.y-o/2,e.bbox.x-t/2],l=Math.sqrt((t/2-e.bbox.x)*(t/2-e.bbox.x)+(o/2-e.bbox.y)*(o/2-e.bbox.y))/Math.sqrt(t*t+o*o)*x,s=180*Math.atan(n[0]/(n[1]||1e-6))/Math.PI;n[1]>=0&&(s+=180);var u=d.rhumbDestination(f,l,(w+s)%360,L),c=_.find(v,(function(e,t){if(d.distance(u,e.location,{units:"kilometers"})<r/1e3){e.points.push(u.geometry.coordinates);var n=[0,0];if(_.each(e.points,(function(e){n[0]+=e[0],n[1]+=e[1]})),n[0]=n[0]/e.points.length,n[1]=n[1]/e.points.length,e.location=d.point(n),!e.marker&&e.points.length>=a){var o=(new i.Marker).setLngLat(n).addTo(h);e.marker=o}else e.marker&&e.marker.setLngLat(n);return!0}}));c||v.push({location:u,points:[u.geometry.coordinates],marker:null})}))})).finally((function(){s=!1,m=Date.now(),e.play()})))}};b()}))}},622:(e,t,n)=>{var o,r,a=function(){if(o&&r){n(567)(r,o)}else{var e=n(29);$("body").html(e({flightLogFile:o,videoFile:r})),$("#videoButton").click((function(){$("#videoInput").click()})),$("#flightLogButton").click((function(){$("#flightLogInput").click()}));var t=function(e){$("#dropContainer").removeClass("bg-gray-900").addClass("bg-green-900"),e.preventDefault(),e.stopPropagation()},i=function(e){$("#dropContainer").addClass("bg-gray-900").removeClass("bg-gray-700"),e.preventDefault(),e.stopPropagation(),_.each(e.originalEvent.dataTransfer.files,(function(e){e.type&&0==e.type.indexOf("video/")?r=e:e.type&&e.type.indexOf("/csv")>=0&&(o=e)})),a()};$("#dropContainer").bind({dragenter:t,dragover:t,dragleave:function(e){$("#dropContainer").addClass("bg-gray-900").removeClass("bg-green-900"),e.preventDefault(),e.stopPropagation()},drop:i,dragdrop:i}),$("#videoInput").change((function(e){r=e.currentTarget.files[0],a()})),$("#flightLogInput").change((function(e){o=e.currentTarget.files[0],a()}))}};e.exports=a}},e=>{var t=t=>e(e.s=t);e.O(0,[111],(()=>(t(225),t(227))));e.O()}]);
//# sourceMappingURL=main.fca0c451d7763621a054.js.map